<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>错季~</title>
<style>
  /* 原有样式保留 */
  html,body{
    height:100%;margin:0;overflow:hidden;
    font-family:"微软雅黑",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:
      radial-gradient(1200px 600px at 50% 45%, rgba(255,255,255,.65), rgba(255,255,255,0) 60%),
      radial-gradient(circle at 50% 45%, #fff4f7 0%, #c9eaff 100%);
  }
  .stage{position:relative;width:100%;height:100%;}
  .msg{
    position:absolute;left:50%;top:50%;
    padding:10px 16px;border-radius:16px;
    color:#fff;font-weight:700;
    font-size:clamp(14px,3vmin,22px);
    text-shadow:0 2px 8px rgba(0,0,0,.28);
    opacity:0;
    transform:
      translate(-50%,-50%) translate(var(--dx),var(--dy)) scale(.75) rotate(var(--rot));
    animation: flight var(--dur) cubic-bezier(.25,.7,.3,1) var(--delay) both;
    box-shadow:0 8px 26px rgba(0,0,0,.22);
    will-change: transform, opacity;
    background: var(--bg);
  }

  @keyframes flight{
    0%{
      opacity:0;
      transform:translate(-50%,-50%) translate(var(--dx),var(--dy)) scale(.75) rotate(var(--rot));
    }
    18%{ opacity:1; }
    45%{
      transform:translate(-50%,-50%) translate(calc(var(--dx)*.2),calc(var(--dy)*.2)) scale(1.06);
    }
    70%{
      transform:translate(-50%,-50%) translate(calc(var(--dx)*1.15),calc(var(--dy)*1.15)) scale(.95) rotate(var(--rot));
    }
    88%{
      transform:translate(-50%,-50%) translate(calc(var(--heart-x)*.6),calc(var(--heart-y)*.6)) scale(.9) rotate(var(--heart-rot));
    }
    100%{
      opacity:1;
      transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1) rotate(var(--heart-rot));
    }
  }

  .msg::before,.msg::after{
    content:'';position:absolute;left:50%;top:0;
    background:inherit;border-radius:50px 50px 0 0;
    width:22px;height:34px;opacity:0;transition:opacity .28s ease;
    transform-origin:0 100%;transform:rotate(-45deg);
  }
  .msg::after{left:0;transform-origin:100% 100%;transform:rotate(45deg);}
  .msg.heart-mode{color:transparent;text-shadow:none;}
  .msg.heart-mode::before,.msg.heart-mode::after{opacity:1;}

  .msg.locked{
    animation:none;
    transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1) rotate(var(--heart-rot));
    opacity:1;
  }
  .msg.locked.pulse{animation:pulse 2.2s ease-in-out 1;}
  @keyframes pulse{
    0%,100%{transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1);}
    50%{transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1.08);}
  }

  .msg.burst{animation: burst 1.4s cubic-bezier(.17,.6,.2,1) forwards;}
  @keyframes burst{
    0%{
      opacity:1;
      transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1);
      filter:blur(0);
    }
    70%{
      opacity:.9;
      transform:translate(-50%,-50%) translate(calc(var(--heart-x) + var(--bx)*0.7), calc(var(--heart-y) + var(--by)*0.7)) scale(.9) rotate(var(--rot));
      filter:blur(.3px);
    }
    100%{
      opacity:0;
      transform:translate(-50%,-50%) translate(calc(var(--heart-x) + var(--bx)), calc(var(--heart-y) + var(--by))) scale(.7) rotate(var(--rot));
      filter:blur(1px);
    }
  }

  .center-title{
    position:absolute;left:50%;top:50%;
    transform:translate(-50%,-50%);
    font-weight:800;letter-spacing:.12em;
    font-size:clamp(18px,4vmin,28px);
    color:rgba(255,105,180,.6);
    text-shadow:0 2px 10px rgba(255,105,180,.15);
    opacity:.0;pointer-events:none;
    animation:titleIn 1.2s ease 0.8s both;
  }
  @keyframes titleIn{
    from{opacity:0;transform:translate(-50%,-55%);}
    to{opacity:.95;transform:translate(-50%,-50%);}
  }

  .replay{
    position:absolute;right:18px;bottom:18px;
    padding:10px 14px;border:none;border-radius:10px;
    background:rgba(255,255,255,.5);
    backdrop-filter:blur(8px);
    color:#222;font-weight:600;cursor:pointer;
    box-shadow:0 5px 20px rgba(0,0,0,.22);
    z-index:100;
  }

  .music-prompt{
    position:absolute;left:50%;top:50%;
    transform:translate(-50%,-50%);
    padding:20px 30px;
    background:rgba(255,255,255,0.9);
    border-radius:15px;
    box-shadow:0 10px 30px rgba(0,0,0,0.2);
    font-size:18px;color:#333;
    z-index:1000;transition:opacity 0.5s ease;
  }

  /* 歌单按钮和容器样式 */
  .playlist-btn{
    position:absolute;left:18px;top:18px;
    padding:8px 12px;border:none;border-radius:8px;
    background:rgba(255,255,255,0.7);
    backdrop-filter:blur(8px);
    color:#333;font-weight:600;cursor:pointer;
    box-shadow:0 3px 10px rgba(0,0,0,0.15);
    z-index:100;display:flex;align-items:center;gap:5px;
  }
  .playlist-container{
    position:absolute;left:18px;top:60px;
    width:220px;max-height:300px;
    background:rgba(255,255,255,0.9);
    backdrop-filter:blur(10px);
    border-radius:10px;
    box-shadow:0 5px 20px rgba(0,0,0,0.2);
    z-index:90;overflow:hidden;
    transition:all 0.3s ease;
    transform-origin:top left;
    transform:scale(0);opacity:0;
  }
  .playlist-container.active{transform:scale(1);opacity:1;}
  .playlist-header{
    padding:10px 15px;border-bottom:1px solid #eee;
    font-weight:600;color:#555;
  }
  .song-list{
    max-height:250px;overflow-y:auto;
    margin:0;padding:0;
  }
  .song-item{
    list-style:none;padding:10px 15px;
    cursor:pointer;transition:background 0.2s;
    font-size:14px;
  }
  .song-item:hover{background:#f0f7ff;}
  .song-item.active{
    background:#e8f0fe;font-weight:bold;
    border-left:3px solid #4285f4;
  }

  /* 播放器样式 */
  .music-player{
    position:absolute;left:50%;bottom:20px;
    transform:translateX(-50%);
    width:90%;max-width:500px;
    background:rgba(255,255,255,0.8);
    backdrop-filter:blur(10px);
    border-radius:12px;padding:10px 15px;
    box-shadow:0 4px 20px rgba(0,0,0,0.15);
    z-index:90;display:flex;align-items:center;gap:10px;
  }
  .audio-player{flex:1;border-radius:8px;}
  .next-btn{
    padding:6px 12px;border:none;border-radius:6px;
    background:#4285f4;color:white;cursor:pointer;
    white-space:nowrap;
  }
  .next-btn:hover{background:#3367d6;}
  .current-song{
    position:absolute;left:50%;bottom:70px;
    transform:translateX(-50%);
    font-size:14px;color:#333;
    background:rgba(255,255,255,0.7);
    padding:3px 10px;border-radius:10px;
    backdrop-filter:blur(5px);
  }

  /* 立冬弹窗样式 */
  .lidong-popup{
    position:fixed;left:0;top:0;
    width:100%;height:100%;
    background:radial-gradient(circle at center, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.7) 100%);
    display:flex;justify-content:center;align-items:center;
    z-index:2000;
    opacity:1;transition:opacity 0.5s ease;
  }
  .popup-content{
    background:linear-gradient(135deg, #fffbf0 0%, #fff0e6 100%);
    padding:35px 40px;
    border-radius:24px;
    font-size:clamp(18px, 4vmin, 28px);
    font-weight:600;
    color:#e65c3c; /* 温暖的橙红色 */
    text-align:center;
    box-shadow:0 15px 40px rgba(230, 92, 60, 0.25); /* 同色系阴影 */
    transform:scale(1);
    transition:transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    max-width:85%;
    line-height:1.8; /* 增加行高提升可读性 */
    border:1px solid rgba(255,218,185,0.5); /* 浅色边框增加层次感 */
  }
  .popup-content::after{
    content:'❄️';
    display:block;
    margin-top:15px;
    font-size:1.5em;
    animation: float 3s ease-in-out infinite;
  }
  @keyframes float{
    0%,100%{transform:translateY(0);}
    50%{transform:translateY(-10px);}
  }
  .lidong-popup.hidden{
    opacity:0;pointer-events:none;
  }
  .lidong-popup.hidden .popup-content{
    transform:scale(0.9);
  }
</style>
</head>
<body>
  <!-- 立冬快乐弹窗（文字分行显示） -->
  <div class="lidong-popup" id="lidongPopup">
    <div class="popup-content">
      希望你们在这个冬天<br>
      一切顺顺利利<br>
      平平安安<br>
      得偿所愿<br>
      按时吃饭<br>
      注意保暖<br>
      立冬快乐 ❄️
    </div>
  </div>

  <!-- 歌单按钮和容器 -->
  <button class="playlist-btn" id="playlist-btn">
    歌单 ▼
  </button>
  <div class="playlist-container" id="playlist-container">
    <div class="playlist-header">歌曲列表</div>
    <ul class="song-list" id="song-list"></ul>
  </div>

  <!-- 音乐播放器 -->
  <div class="current-song" id="current-song">准备播放...</div>
  <div class="music-player">
    <audio id="audio-player" class="audio-player" controls>
      您的浏览器不支持音频播放
    </audio>
    <button class="next-btn" id="next-btn">下一首（随机）</button>
  </div>

  <!-- 音乐播放提示 -->
  <div class="music-prompt" id="music-prompt">
    点击页面任意位置开始播放音乐
  </div>

  <div class="stage" id="stage">
    <div class="center-title" id="title">for you ♥</div>
  </div>
  <button class="replay" id="replay">重放</button>

<script>
/* 原有逻辑保持不变 */
const tips=[
  '天天开心','我好想你','照顾好自己','我好爱你','记得多穿衣服','记得开心','一切顺利',
  '你要好好的','我会一直在','嘿嘿','我在呢','熬夜息','多喝热水','出门带伞',
  '按时吃饭','想你了','抱抱你','不怕 有我呢','我一直在等你','平安顺遂',
  '路上注意安全','相信自己','我们俩','早点休息','摸摸头','好梦常在',
  '平安喜乐','平安顺遂','注意保暖','多穿衣服','照顾好自己','空悲切'
];

const stage  = document.getElementById('stage');
const replay = document.getElementById('replay');
const title  = document.getElementById('title');
const musicPrompt = document.getElementById('music-prompt');
// 立冬弹窗元素
const lidongPopup = document.getElementById('lidongPopup');

// 关闭立冬弹窗函数
function closeLidongPopup() {
  lidongPopup.classList.add('hidden');
}

// 动画相关函数保留
const directions = [
  {dx:'0vw',dy:'-80vh'},{dx:'0vw',dy:'80vh'},
  {dx:'-80vw',dy:'0vh'},{dx:'80vw',dy:'0vh'},
  {dx:'-70vw',dy:'-70vh'},{dx:'70vw',dy:'-70vh'},
  {dx:'-70vw',dy:'70vh'},{dx:'70vw',dy:'70vh'},
  {dx:'0vw',dy:'-60vh'},{dx:'0vw',dy:'60vh'},
  {dx:'-60vw',dy:'0vh'},{dx:'60vw',dy:'0vh'}
];

function rand(min,max){return Math.random()*(max-min)+min;}
function randomGradient(){
  const arr=[
    ['#ff758c','#ff7eb3'], ['#a18cd1','#fbc2eb'],
    ['#f6d365','#fda085'], ['#84fab0','#8fd3f4'],
    ['#f093fb','#f5576c'], ['#4facfe','#00f2fe'],
    ['#43e97b','#38f9d7'], ['#fa709a','#fee140'],
    ['#30cfd0','#330867'], ['#5ee7df','#b490ca']
  ];
  const [c1,c2]=arr[Math.floor(Math.random()*arr.length)];
  return `linear-gradient(135deg,${c1},${c2})`;
}

function heartXY(t){
  const s = 16;
  const x = s * (16 * Math.sin(t)**3);
  const y = -s * (13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
  return {x: x+'px', y: y+'px'};
}

function createMsg(i,total){
  const el = document.createElement('div');
  el.className = 'msg';

  const d = directions[Math.floor(Math.random()*directions.length)];
  el.style.setProperty('--dx', d.dx);
  el.style.setProperty('--dy', d.dy);
  el.style.setProperty('--rot', rand(-55,55)+'deg');
  el.style.setProperty('--dur', (rand(6.8,8.6))+'s');
  el.style.setProperty('--delay', (i*0.11 + rand(0,0.35))+'s');
  el.style.setProperty('--bg', randomGradient());

  const t = (i / total) * Math.PI * 2;
  const {x,y} = heartXY(t);
  el.style.setProperty('--heart-x', x);
  el.style.setProperty('--heart-y', y);
  el.style.setProperty('--heart-rot', rand(-18,18)+'deg');

  const span = document.createElement('span');
  span.className = 'text';
  span.textContent = tips[Math.floor(Math.random()*tips.length)];
  el.appendChild(span);

  const delay = parseFloat(el.style.getPropertyValue('--delay'));
  const dur   = parseFloat(el.style.getPropertyValue('--dur'));
  const switchAt = delay + dur * 0.86;
  const switchTimer = setTimeout(()=>{ el.classList.add('heart-mode'); }, switchAt*1000);

  el.addEventListener('animationend',()=>{
    clearTimeout(switchTimer);
    el.classList.add('heart-mode','locked','pulse');

    const spread = rand(140, 260);
    const ang    = rand(0, Math.PI*2);
    const bx = Math.cos(ang)*spread;
    const by = Math.sin(ang)*spread;
    el.style.setProperty('--bx', bx+'px');
    el.style.setProperty('--by', by+'px');
  }, {once:true});

  stage.appendChild(el);
}

function finalBurst(){
  stage.querySelectorAll('.msg.locked').forEach(el=>{
    el.classList.remove('pulse');
    const jitter = rand(0, 200);
    setTimeout(()=> el.classList.add('burst'), jitter);
    el.addEventListener('animationend',()=> el.remove(), {once:true});
  });
}

function playAnimation(){
  stage.querySelectorAll('.msg').forEach(n=>n.remove());
  title.style.opacity = 0;

  const TOTAL = 256;
  for(let i=0;i<TOTAL;i++) createMsg(i,TOTAL);

  setTimeout(()=>{ title.style.opacity = 1; }, 1400);

  const TOTAL_TIME_MS = (8.6 + 0.35 + 0.3 + 2.2) * 1000;
  setTimeout(finalBurst, TOTAL_TIME_MS);
}

/* 音乐播放器核心逻辑 */
// 歌曲列表
const songs = [
  { src: "https://cuoji520.github.io/musicios/瞬.m4a", name: "瞬" },
  { src: "https://cuoji520.github.io/musicios/不将就.m4a", name: "不将就" },
  { src: "https://cuoji520.github.io/musicios/去北极忘记你.m4a", name: "去北极忘记你" },
  { src: "https://cuoji520.github.io/musicios/如果呢.m4a", name: "如果呢" },
  { src: "https://cuoji520.github.io/musicios/暗号.m4a", name: "暗号" },
  { src: "https://cuoji520.github.io/musicios/关键词.m4a", name: "关键词" },
  { src: "https://cuoji520.github.io/musicios/lots.m4a", name: "lots" },
];

// DOM元素
const audioPlayer = document.getElementById('audio-player');
const currentSongEl = document.getElementById('current-song');
const nextBtn = document.getElementById('next-btn');
const playlistBtn = document.getElementById('playlist-btn');
const playlistContainer = document.getElementById('playlist-container');
const songListEl = document.getElementById('song-list');

// 状态变量
let currentIndex = -1;
let isFirstPlay = true;

// 初始化歌单列表
function initSongList() {
  songListEl.innerHTML = '';
  songs.forEach((song, index) => {
    const li = document.createElement('li');
    li.className = 'song-item';
    li.textContent = song.name;
    li.addEventListener('click', () => {
      playSong(index);
      togglePlaylist();
    });
    songListEl.appendChild(li);
  });
}

// 播放指定索引的歌曲
function playSong(index) {
  if (index < 0 || index >= songs.length) return;

  currentIndex = index;
  const song = songs[index];
  currentSongEl.textContent = `正在播放：${song.name}`;

  audioPlayer.src = song.src;
  audioPlayer.load();

  audioPlayer.play().catch(err => {
    console.log('播放需要用户交互:', err);
    currentSongEl.textContent += '（请点击播放器）';
  });

  updateSongHighlight();
}

// 随机播放下一首
function playRandom() {
  if (songs.length <= 1) {
    playSong(0);
    return;
  }
  let randomIndex;
  do {
    randomIndex = Math.floor(Math.random() * songs.length);
  } while (randomIndex === currentIndex);
  playSong(randomIndex);
}

// 更新歌单高亮
function updateSongHighlight() {
  const items = document.querySelectorAll('.song-item');
  items.forEach((item, index) => {
    item.classList.toggle('active', index === currentIndex);
  });
}

// 切换歌单展开/收起
function togglePlaylist() {
  playlistContainer.classList.toggle('active');
  playlistBtn.innerHTML = playlistContainer.classList.contains('active')
    ? '歌单 ▲'
    : '歌单 ▼';
}

// 处理首次播放
function handleFirstPlay() {
  if (isFirstPlay) {
    isFirstPlay = false;
    musicPrompt.style.opacity = 0;
    setTimeout(() => {
      musicPrompt.style.display = 'none';
    }, 500);
    playRandom();
  }
}

// 绑定事件
function bindEvents() {
  lidongPopup.addEventListener('click', closeLidongPopup);
  playlistBtn.addEventListener('click', togglePlaylist);
  nextBtn.addEventListener('click', playRandom);
  audioPlayer.addEventListener('ended', playRandom);
  document.addEventListener('click', handleFirstPlay, { once: true });
  replay.addEventListener('click', playAnimation);
}

// 初始化
function init() {
  initSongList();
  bindEvents();
  playAnimation();
}

// 页面加载后初始化
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>